#include <16F887.h>
#fuses XT, NOWDT, NOPUT, NOLVP
#use delay(clock=12000000)

#define SERVO PIN_C2

void servo_write(int angle) {
   int pulse_width = 500 + ((int32)angle * 2000 / 180);
   output_high(SERVO);
   delay_us(pulse_width);
   output_low(SERVO);
   delay_ms(20 - pulse_width / 1000);
}

void hold_position(int angle, int repeat) {
   int i;
   for(i = 0; i < repeat; i++) {
      servo_write(angle);
   }
}

void main() {
   set_tris_c(0x00);
   int angle;

   while(true) {
      // Quay t? 0 d?n 90 d?
      for(angle = 0; angle <= 90; angle++) {
         hold_position(angle, 10); // 10 xung PWM ˜ 200ms
      }

      hold_position(90, 100); // Gi? ? 90 d? trong 2s (100 xung x 20ms)

      // Quay t? 90 v? 0 d?
      for(angle = 90; angle >= 0; angle--) {
         hold_position(angle, 10); // 10 xung PWM ˜ 200ms
      }

      hold_position(0, 100); // Gi? ? 0 d? trong 2s
   }
}

