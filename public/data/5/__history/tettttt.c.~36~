#include <16F887.h>
#fuses XT, NOWDT, NOPUT, NOLVP
#use delay(clock=12000000)

#define SERVO_PIN PIN_C2

void servo_write(int angle) {
   int pulse_width = 500 + ((int32)angle * 2000 / 180);  // Xác d?nh d? r?ng xung PWM (1ms -> 2ms)
   output_high(SERVO_PIN);        // B?t tín hi?u PWM
   delay_us(pulse_width);         // T?o xung PWM v?i d? r?ng xác d?nh
   output_low(SERVO_PIN);         // T?t tín hi?u PWM
   delay_ms(20 - pulse_width / 1000);  // T?ng th?i gian xung PWM là 20ms
}

void main() {
   set_tris_c(0x00);  // C?u hình chân C2 (SERVO_PIN) làm d?u ra

   while(true) {
      // Quay t? 0 d?n 90 d?
      for (int angle = 0; angle <= 90; angle++) {
         servo_write(angle);  // G?i tín hi?u PWM cho servo
         delay_ms(20);        // Delay gi?a các bu?c di chuy?n
      }

      delay_ms(2000);  // Gi? servo ? 90 d? trong 2 giây

      // Quay t? 90 v? 0 d?
      for (int angle = 90; angle >= 0; angle--) {
         servo_write(angle);  // G?i tín hi?u PWM cho servo
         delay_ms(20);        // Delay gi?a các bu?c di chuy?n
      }

      delay_ms(2000);  // Gi? servo ? 0 d? trong 2 giây
   }
}

